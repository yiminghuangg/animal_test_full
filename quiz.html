
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Âä®Áâ©Â°ëÊµã ¬∑ ÊµãËØï‰∏≠</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .quiz-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-top: 40px;
        margin-bottom: 40px;
      }
      
      .quiz-header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      .quiz-header h1 {
        color: #1a1a1a;
        margin: 0;
      }
      
      .quiz-progress {
        height: 8px;
        background-color: #f0f0f0;
        border-radius: 4px;
        margin-bottom: 30px;
        overflow: hidden;
      }
      
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #8A2BE2, #4B0082);
        border-radius: 4px;
        transition: width 0.3s ease;
      }
      
      .question-counter {
        text-align: center;
        color: #666;
        margin-bottom: 20px;
        font-size: 14px;
      }
      
      .question-text {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 30px;
        line-height: 1.4;
        text-align: center;
        color: #1a1a1a;
      }
      
      .options-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .option {
        padding: 18px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
      }
      
      .option:hover {
        border-color: #8A2BE2;
        background-color: #f8f5ff;
      }
      
      .option.selected {
        border-color: #8A2BE2;
        background-color: #f0e6ff;
      }
      
      .option-label {
        display: inline-block;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        border-radius: 50%;
        background-color: #f0f0f0;
        margin-right: 15px;
        font-weight: 600;
        color: #555;
      }
      
      .option.selected .option-label {
        background-color: #8A2BE2;
        color: white;
      }
      
      .option-text {
        flex: 1;
        color: #333;
        font-weight: 500;
      }
      
      .option.selected .option-text {
        color: #222;
        font-weight: 600;
      }
      
      .quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }
      
      .nav-button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .prev-button {
        background-color: #f0f0f0;
        color: #555;
      }
      
      .prev-button:hover:not(:disabled) {
        background-color: #e0e0e0;
      }
      
      .prev-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .next-button {
        background: linear-gradient(90deg, #8A2BE2, #4B0082);
        color: white;
      }
      
      .next-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(138, 43, 226, 0.3);
      }
      
      .next-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .submit-button {
        background: linear-gradient(90deg, #4CAF50, #2E7D32);
      }
      
      .submit-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
      }
      
      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #666;
      }
      
      .error-message {
        text-align: center;
        padding: 40px;
        color: #d32f2f;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <header class="nav">
      <div class="nav__brand">
        <span class="brand__logo">ü¶ä</span>
        <div class="brand__text">
          <div class="brand__cn">Âä®Áâ©Â°ëÊµã</div>
          <div class="brand__en">Animal Personality Test</div>
        </div>
      </div>
      <nav class="nav__links">
        <a href="index.html" class="nav__link"><span>üè†</span> È¶ñÈ°µ</a>
        <a href="#" class="nav__link active"><span>üß™</span> ÊµãËØï‰∏≠</a>
        <a href="#" class="nav__link"><span>üìï</span> Â∞èÁ∫¢‰π¶‰∏ªÈ°µ</a>
      </nav>
    </header>

    <main class="main">
      <div class="quiz-container">
        <div id="loading" class="loading">Ê≠£Âú®Âä†ËΩΩÈ¢òÁõÆ...</div>
        <div id="error" class="error-message" style="display: none;">
          Âä†ËΩΩÈ¢òÁõÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï„ÄÇ
        </div>
        <div id="quiz-content" style="display: none;">
          <div class="quiz-header">
            <h1>Âä®Áâ©ÊÄßÊ†ºÊµãËØï</h1>
          </div>
          
          <div class="quiz-progress">
            <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
          </div>
          
          <div id="question-counter" class="question-counter">
            È¢òÁõÆ 1 / 60
          </div>
          
          <div id="question-text" class="question-text">
            <!-- È¢òÁõÆÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
          </div>
          
          <div id="options-container" class="options-container">
            <!-- ÈÄâÈ°πÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
          </div>
          
          <div class="quiz-navigation">
            <button id="prev-button" class="nav-button prev-button" disabled>‰∏ä‰∏ÄÈ¢ò</button>
            <button id="next-button" class="nav-button next-button" disabled>‰∏ã‰∏ÄÈ¢ò</button>
          </div>
        </div>
      </div>
    </main>

    <script src="scripts/scoring.js"></script>
    <script>
      // ÊéàÊùÉÈ™åËØÅÊ£ÄÊü•
      (function checkAuth() {
        // ‰ªélocalStorage‰∏≠Ëé∑ÂèñÊéàÊùÉÁä∂ÊÄÅÂíåÈÖçÁΩÆ
        const authStatus = localStorage.getItem('quizAuthStatus');
        const authTimestamp = localStorage.getItem('quizAuthTimestamp');
        const authExpiry = localStorage.getItem('quizAuthExpiry');
        const now = new Date().getTime();
        
        // ÈªòËÆ§10ÂàÜÈíüÊúâÊïàÊúüÔºå‰ºòÂÖà‰ΩøÁî®localStorage‰∏≠Â≠òÂÇ®ÁöÑËøáÊúüÊó∂Èó¥ÈÖçÁΩÆ
        const defaultExpiryMinutes = 10;
        const expiryMinutes = authExpiry ? parseInt(authExpiry) : defaultExpiryMinutes;
        const expiryMilliseconds = expiryMinutes * 60 * 1000;
        
        // Ê£ÄÊü•ÊéàÊùÉÁä∂ÊÄÅÊòØÂê¶ÊúâÊïà‰∏îÊú™ËøáÊúü
        if (!authStatus || authStatus !== 'valid' || 
            !authTimestamp || (now - parseInt(authTimestamp)) > expiryMilliseconds) {
          // Êú™ÊéàÊùÉÊàñÊéàÊùÉÂ∑≤ËøáÊúüÔºåÈáçÂÆöÂêëÂà∞È¶ñÈ°µ
          window.location.href = 'index.html';
        }
      })();
      
      // ÊµãËØïÁä∂ÊÄÅÁÆ°ÁêÜ
      const quizState = {
        questions: [],
        currentQuestionIndex: 0,
        answers: {},
        isLoading: true,
        error: null
      };

      // DOM ÂÖÉÁ¥†
      const elements = {
        loading: document.getElementById('loading'),
        error: document.getElementById('error'),
        quizContent: document.getElementById('quiz-content'),
        progressBar: document.getElementById('progress-bar'),
        questionCounter: document.getElementById('question-counter'),
        questionText: document.getElementById('question-text'),
        optionsContainer: document.getElementById('options-container'),
        prevButton: document.getElementById('prev-button'),
        nextButton: document.getElementById('next-button')
      };

      // Âä†ËΩΩÈ¢òÁõÆÊï∞ÊçÆ
      async function loadQuestions() {
        try {
          const response = await fetch('questions.json');
          if (!response.ok) {
            throw new Error('Failed to load questions');
          }
          const questionsData = await response.json();
          
          quizState.questions = questionsData.map((q, index) => ({
            id: index + 1,
            question: q.text,  // Ê≠£Á°ÆÊò†Â∞Ñ text -> question
            options: q.options.map((opt, i) => ({
              value: String.fromCharCode(65 + i),
              text: opt.text,
              weights: opt.weights
            }))
          }));
          
          quizState.isLoading = false;
          initializeQuiz();
        } catch (error) {
          console.error('Error loading questions:', error);
          quizState.error = error;
          quizState.isLoading = false;
          renderError();
        }
      }

      // ÂàùÂßãÂåñÊµãËØï
      function initializeQuiz() {
        if (quizState.questions.length === 0) {
          renderError();
          return;
        }

        renderQuestion();
        updateNavigationButtons();
        
        // ÊòæÁ§∫ÊµãËØïÂÜÖÂÆπ
        elements.loading.style.display = 'none';
        elements.quizContent.style.display = 'block';
      }

      // Ê∏≤ÊüìÈîôËØØ‰ø°ÊÅØ
      function renderError() {
        elements.loading.style.display = 'none';
        elements.error.style.display = 'block';
      }

      // Ê∏≤ÊüìÂΩìÂâçÈ¢òÁõÆ
      function renderQuestion() {
        const question = quizState.questions[quizState.currentQuestionIndex];
        
        const progress = ((quizState.currentQuestionIndex + 1) / quizState.questions.length) * 100;
        elements.progressBar.style.width = `${progress}%`;
        
        elements.questionCounter.textContent = `È¢òÁõÆ ${quizState.currentQuestionIndex + 1} / ${quizState.questions.length}`;
        elements.questionText.textContent = question.question || question.text; // ÂÖºÂÆπ‰∏§ÁßçÂ≠óÊÆµÂêç
        
        elements.optionsContainer.innerHTML = '';
        
        question.options.forEach(option => {
          const optionElement = document.createElement('div');
          optionElement.className = 'option';
          
          const isSelected = quizState.answers[question.id] === option.value;
          if (isSelected) {
            optionElement.classList.add('selected');
          }
          
          optionElement.innerHTML = `
            <span class="option-label">${option.value}</span>
            <span class="option-text">${option.text}</span>
          `;
          
          optionElement.addEventListener('click', () => selectOption(question.id, option.value));
          elements.optionsContainer.appendChild(optionElement);
        });
      }

      // ÈÄâÊã©ÈÄâÈ°π
      function selectOption(questionId, optionValue) {
        quizState.answers[questionId] = optionValue;

        // Â¢ûÈáè‰øùÂ≠òÁ≠îÊ°àÂà∞ localStorageÔºåÈôç‰ΩéÊÑèÂ§ñ‰∏¢Â§±È£éÈô©
        try {
          localStorage.setItem('quizAnswers', JSON.stringify(quizState.answers));
        } catch (e) {
          console.warn('‰øùÂ≠òÁ≠îÊ°àÂà∞ localStorage Â§±Ë¥•:', e);
        }

        // Êõ¥Êñ∞UI
        const optionElements = elements.optionsContainer.querySelectorAll('.option');
        optionElements.forEach(element => {
          const label = element.querySelector('.option-label').textContent;
          if (label === optionValue) {
            element.classList.add('selected');
          } else {
            element.classList.remove('selected');
          }
        });
        
        // Ê£ÄÊü•ÊòØÂê¶ÊòØÊúÄÂêé‰∏ÄÈ¢ò
        if (quizState.currentQuestionIndex === quizState.questions.length - 1) {
          // ÊúÄÂêé‰∏ÄÈ¢òÔºåÂêØÁî®Êèê‰∫§ÊåâÈíÆ
          elements.nextButton.disabled = false;
        } else {
          // ‰∏çÊòØÊúÄÂêé‰∏ÄÈ¢òÔºåÁõ¥Êé•Ë∑≥ËΩ¨Âà∞‰∏ã‰∏ÄÈ¢ò
          setTimeout(() => {
            goToNextQuestionOrSubmit();
          }, 300); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºåËÆ©Áî®Êà∑ÁúãÂà∞ÈÄâÊã©ÊïàÊûú
        }
      }

      // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
      function updateNavigationButtons() {
        // ‰∏ä‰∏ÄÈ¢òÊåâÈíÆ
        elements.prevButton.disabled = quizState.currentQuestionIndex === 0;
        
        if (quizState.currentQuestionIndex === quizState.questions.length - 1) {
          // ÊúÄÂêé‰∏ÄÈ¢òÔºåÊòæÁ§∫Êèê‰∫§ÊåâÈíÆÔºå‰ΩÜÂàùÂßãÁä∂ÊÄÅ‰∏∫Á¶ÅÁî®
          elements.nextButton.style.display = 'block';
          elements.nextButton.textContent = 'Êèê‰∫§ÊµãËØï';
          elements.nextButton.className = 'nav-button submit-button';
          elements.nextButton.disabled = true;
        } else {
          // ÊòæÁ§∫‰∏ã‰∏ÄÈ¢òÊåâÈíÆÔºå‰ΩÜ‰øùÊåÅÁ¶ÅÁî®Áä∂ÊÄÅ
          elements.nextButton.style.display = 'block';
          elements.nextButton.disabled = true;
          elements.nextButton.textContent = '‰∏ã‰∏ÄÈ¢ò';
          elements.nextButton.className = 'nav-button next-button';
        }
      }

      // ‰∏ä‰∏ÄÈ¢ò
      function goToPreviousQuestion() {
        if (quizState.currentQuestionIndex > 0) {
          quizState.currentQuestionIndex--;
          renderQuestion();
          updateNavigationButtons();
        }
      }

      // ‰∏ã‰∏ÄÈ¢òÊàñÊèê‰∫§ÊµãËØï
      function goToNextQuestionOrSubmit() {
        if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
          // ‰∏ã‰∏ÄÈ¢ò
          quizState.currentQuestionIndex++;
          renderQuestion();
          updateNavigationButtons();
        } else {
          // ÊúÄÂêé‰∏ÄÈ¢òÔºåÁõ¥Êé•Êèê‰∫§ÊµãËØï
          submitQuiz();
        }
      }

      // Êèê‰∫§ÊµãËØï
      function submitQuiz() {
        // Â∞ÜÁ≠îÊ°àÂ≠òÂÇ®Âú®localStorage‰∏≠Ôºå‰æõÁªìÊûúÈ°µÈù¢‰ΩøÁî®
        localStorage.setItem('quizAnswers', JSON.stringify(quizState.answers));
        
        // Ë∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢
        window.location.href = 'result.html';
      }

      // ‰∫ã‰ª∂ÁõëÂê¨Âô®
      elements.prevButton.addEventListener('click', goToPreviousQuestion);
      elements.nextButton.addEventListener('click', goToNextQuestionOrSubmit);

      // ÂàùÂßãÂåñ
      loadQuestions();
    </script>
  </body>
</html>





